name: ğŸ­ Reddit Production System
on:
  schedule:
    # ØªØ´ØºÙŠÙ„ ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚
    - cron: '*/5 * * * *'
  
  workflow_dispatch:  # ØªØ´ØºÙŠÙ„ ÙŠØ¯ÙˆÙŠ
    inputs:
      target_count:
        description: 'Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ©'
        required: false
        default: '100'
        type: string

jobs:
  production-run:
    name: ğŸš€ ØªØ´ØºÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ù†ØªØ§Ø¬
    runs-on: ubuntu-latest
    timeout-minutes: 360  # 6 Ø³Ø§Ø¹Ø§Øª ÙƒØ­Ø¯ Ø£Ù‚ØµÙ‰
    
    steps:
    - name: ğŸ“¥ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙˆØ¯
      uses: actions/checkout@v4
    
    - name: ğŸ—ï¸ Ø¥Ø¹Ø¯Ø§Ø¯ Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
    
    - name: ğŸ› ï¸ ØªØ«Ø¨ÙŠØª Chrome
      run: |
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable
        google-chrome --version
    
    - name: ğŸ“¦ ØªØ«Ø¨ÙŠØª Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ÙŠØ§Øª
      run: npm ci
    
    - name: ğŸ” ÙØ­Øµ Ø§Ù„Ù†Ø´Ø±
      env:
        PROXY_LIST: ${{ secrets.PROXY_LIST }}
        GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
        SHEET_ID: ${{ secrets.SHEET_ID }}
      run: node src/deployment-check.js
    
    - name: ğŸš€ ØªØ´ØºÙŠÙ„ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ù†ØªØ§Ø¬
      env:
        PROXY_LIST: ${{ secrets.PROXY_LIST }}
        GOOGLE_CREDENTIALS: ${{ secrets.GOOGLE_CREDENTIALS }}
        SHEET_ID: ${{ secrets.SHEET_ID }}
        NODE_ENV: 'production'
      run: node src/main.js
    
    - name: ğŸ“Š Ø­ÙØ¸ Ø§Ù„Ø³Ø¬Ù„Ø§Øª
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: production-logs-${{ github.run_id }}
        path: |
          *.log
        retention-days: 7
